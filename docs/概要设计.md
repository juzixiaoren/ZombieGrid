# 网格交易神器概要设计

## 1 项目概述

### 1.1 项目名称

网格交易神器（ZombieGrid）

### 1.2 项目背景

网格交易是一种经典的量化交易策略，通过在价格区间内分批买入和卖出，实现低买高卖。本项目旨在开发一款命令行回测工具，帮助用户验证网格交易策略的有效性。

### 1.3 项目目标

- 提供用户友好的命令行界面，支持策略参数配置
- 自动生成网格交易模型并进行历史数据回测
- 输出详细的交易记录和量化绩效指标
- 支持数据导入、策略管理和结果导出

## 2 系统架构

### 2.1 整体架构

系统采用分层架构：

- **表示层**：命令行界面（CLI），负责用户交互
- **业务逻辑层**：策略生成、回测引擎、绩效分析
- **数据访问层**：数据库操作、数据导入导出
- **数据存储层**：SQLite数据库存储策略、数据和结果(使用Sqlite3作为数据库)

### 2.2 模块划分

1. **CLI模块**（service/cli.py）：主界面和菜单处理
2. **策略管理模块**（util/build_grid_model.py）：网格模型生成
3. **回测模块**（util/backtest.py）：交易模拟和指标计算
4. **数据管理模块**（dao/）：数据库操作和数据导入
5. **工具模块**（util/）：辅助功能如数据转换

### 2.3 技术栈

- **编程语言**：Python 3.x
- **数据库**：SQLite（通过SQLAlchemy ORM）
- **数据处理**：Pandas、NumPy
- **UI**：命令行（tabulate用于表格显示）
- **依赖管理**：requirements.txt
- **虚拟环境：**使用conda管理依赖包

## 3 功能需求

### 3.1 核心功能

- 策略创建：输入参数生成网格模型
- 数据导入：从Excel导入历史行情数据
- 回测执行：模拟交易并计算指标
- 结果输出：控制台显示和Excel导出

### 3.2 非功能需求

- 性能：支持数千条数据快速回测
- 可靠性：完善的错误处理和数据校验
- 可维护性：模块化设计，清晰注释
- 用户体验：友好的命令行提示和进度显示

## 4 数据流程

1. 用户通过CLI输入策略参数
2. 系统生成网格模型并存储到数据库
3. 用户导入历史数据并存储
4. 选择策略和数据执行回测
5. 系统模拟交易，记录流水和每日快照
6. 计算绩效指标并输出结果
7. 可选导出Excel报告

## 5 风险评估

### 5.1 技术风险

- 数据格式不匹配：通过校验和转换处理
- 内存不足：分批处理大数据
- 依赖库兼容性：固定版本号

### 5.2 业务风险

- 策略参数无效：输入校验
- 回测结果不准确：逻辑测试和边界条件检查

## 6 实施计划

### 6.1 开发阶段

1. 核心模块开发（策略生成、回测引擎）
2. 数据库设计和数据导入
3. CLI界面开发
4. 测试和优化

### 6.2 部署和维护

- 单机部署，无需服务器
- 采用conda虚拟环境(miniconda)管理依赖
- 通过requirements.txt维护关键依赖，采用requireinstall.bat脚本快速检查并安装依赖
- 定期更新依赖和优化性能
